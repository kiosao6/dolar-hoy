---
import Layout from '../layouts/Layout.astro';
import MainAmount from '@components/mainAmount/MainAmount.astro';
import Form from '@components/inputFields/Form.astro';
import { CurrencyButton } from '@components/currencyButton/CurrencyButton';

import { paraleloPrice, bcvPrice, lastUpdated } from "src/store";

const DOLLAR_URL = 'https://pydolarvenezuela-api.vercel.app/api/v1/dollar'
const response = await fetch(DOLLAR_URL);
const data = await response.json();
paraleloPrice.set(data.monitors.enparalelovzla.price)
bcvPrice.set(data.monitors.bcv.price)
lastUpdated.set(data.monitors.bcv.last_update)

---

<Layout title="Welcome to Astro.">
	<main class="max-w-2xl mx-auto mt-8 px-8 xl:px-0">
		<header class="space-y-1">
			<h1 class="text-3xl tracking-tight font-[550]">Calculadora</h1>
			<h2 class="text-neutral-500 text-[15px] tracking-tight">Convierte dólares a bolívares usando la tasa de tu preferencia</h2>
		</header>
		<section class="w-full border rounded-xl mt-8 p-6">
			<div class="flex bg-zinc-100 gap-2 w-fit p-2 rounded-lg h-11 items-center text-xs tracking-tight">
				<CurrencyButton title='BCV' amount={bcvPrice.get()} client:visible />
				<CurrencyButton title='Paralelo' amount={paraleloPrice.get()} client:visible />
			</div>

			<MainAmount amount={`${bcvPrice.get()}`} />
			<Form />
		</section>
	</main>
</Layout>
